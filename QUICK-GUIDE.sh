#!/bin/bash
# Quick Setup Guide - Run this for complete installation

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘         IRS Database Server Setup - Quick Guide             â•‘"
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo ""
echo "ğŸ“‹ STEP 1: Install Java, Maven, Docker & PostgreSQL"
echo "   Command: ./setup-docker-postgres.sh"
echo ""
echo "   What it does:"
echo "   âœ“ Checks and installs Java 17 (OpenJDK)"
echo "   âœ“ Checks and installs Maven"
echo "   âœ“ Checks and installs Docker"
echo "   âœ“ Pulls PostgreSQL 17 with PostGIS 3.4"
echo "   âœ“ Creates container 'postgres-irs'"
echo "   âœ“ Configures database 'irs'"
echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
echo "ğŸ“‹ STEP 2: Create Schema & Import Data"
echo "   Command: ./setup-database.sh"
echo ""
echo "   What it does:"
echo "   âœ“ Shows all paths for verification"
echo "   âœ“ Creates database schema (users, roles, accident reports, etc.)"
echo "   âœ“ Inserts initial data"
echo "   âœ“ Automatically imports ALL CSV files from the CSV directory"
echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
echo "ğŸ”§ PATH CONFIGURATION (in setup-database.sh)"
echo ""
echo "   BASE_DIR:         Auto-detected project root"
echo "   PROJECT_SQL_DIR:  src/main/resources/script_queries"
echo "   PROJECT_CSV_DIR:  src/main/resources/files (all .csv files)"
echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
echo "âš™ï¸  DATABASE CONFIGURATION"
echo ""
echo "   Host:     0.0.0.0 (localhost)"
echo "   Port:     5432"
echo "   Database: irs"
echo "   Username: postgres"
echo "   Password: admin123/?"
echo ""
echo "   JDBC URL: jdbc:postgresql://localhost:5432/irs"
echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
echo "âœ… KEY FEATURES"
echo ""
echo "   âœ“ Scripts are IDEMPOTENT (safe to run multiple times)"
echo "   âœ“ Tables use CREATE IF NOT EXISTS"
echo "   âœ“ Data uses ON CONFLICT DO NOTHING"
echo "   âœ“ Path validation before execution"
echo "   âœ“ No data loss on re-run"
echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
echo "ğŸš€ QUICK START"
echo ""
echo "   # Make scripts executable"
echo "   chmod +x setup-docker-postgres.sh setup-database.sh"
echo ""
echo "   # Install Java, Maven, Docker & PostgreSQL"
echo "   ./setup-docker-postgres.sh"
echo ""
echo "   # Create database schema and import data"
echo "   ./setup-database.sh"
echo ""
echo "   # Start your Quarkus app"
echo "   ./mvnw quarkus:dev"
echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
echo "ğŸ› ï¸  USEFUL COMMANDS"
echo ""
echo "   # Check container status"
echo "   docker ps | grep postgres-irs"
echo ""
echo "   # Connect to database"
echo "   docker exec -it postgres-irs psql -U postgres -d irs"
echo ""
echo "   # View container logs"
echo "   docker logs postgres-irs"
echo ""
echo "   # Start/Stop container"
echo "   docker start postgres-irs"
echo "   docker stop postgres-irs"
echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
echo "â“ TROUBLESHOOTING"
echo ""
echo "   Path not found?"
echo "   â†’ Check paths in setup-database.sh (lines 22-28)"
echo ""
echo "   Container already exists?"
echo "   â†’ Script will detect and ask to recreate or keep"
echo ""
echo "   Table already exists error?"
echo "   â†’ Safe to ignore - using IF NOT EXISTS"
echo ""
echo "   CSV import fails?"
echo "   â†’ Verify CSV file exists at specified path"
echo ""
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

read -p "Press Enter to continue..."
